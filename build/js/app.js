var APP={Player:function(){var h,v,p,t,l=new THREE.ObjectLoader,f={},E=document.createElement("div");function w(e,t){for(var n=0,o=e.length;n<o;n++)e[n](t)}function e(e){try{w(f.update,{time:e,delta:e-t})}catch(e){console.error(e.message||e,e.stack||"")}p.render(v,h),t=e}function n(e){w(f.keydown,e)}function o(e){w(f.keyup,e)}function i(e){w(f.mousedown,e)}function r(e){w(f.mouseup,e)}function s(e){w(f.mousemove,e)}function a(e){w(f.touchstart,e)}function d(e){w(f.touchend,e)}function u(e){w(f.touchmove,e)}this.dom=E,this.width=500,this.height=500,this.load=function(e){(p=new THREE.WebGLRenderer({antialias:!0})).setClearColor(0),p.setPixelRatio(window.devicePixelRatio),e.project.gammaInput&&(p.gammaInput=!0),e.project.gammaOutput&&(p.gammaOutput=!0),e.project.shadows&&(p.shadowMap.enabled=!0),e.project.vr&&(p.vr.enabled=!0),E.appendChild(p.domElement),this.setScene(l.parse(e.scene)),this.setCamera(l.parse(e.camera)),f={init:[],start:[],stop:[],keydown:[],keyup:[],mousedown:[],mouseup:[],mousemove:[],touchstart:[],touchend:[],touchmove:[],update:[]};var t="player,renderer,scene,camera",n={};for(var o in f)t+=","+o,n[o]=o;var i=JSON.stringify(n).replace(/\"/g,"");for(var r in e.scripts){var s=v.getObjectByProperty("uuid",r,!0);if(void 0!==s)for(var a=e.scripts[r],d=0;d<a.length;d++){var u=a[d],c=new Function(t,u.source+"\nreturn "+i+";").bind(s)(this,p,v,h);for(var m in c)void 0!==c[m]&&(void 0!==f[m]?f[m].push(c[m].bind(s)):console.warn("APP.Player: Event type not supported (",m,")"))}else console.warn("APP.Player: Script without object.",r)}w(f.init,arguments)},this.setCamera=function(e){(h=e).aspect=this.width/this.height,h.updateProjectionMatrix(),p.vr.enabled&&(WEBVR.checkAvailability().catch(function(e){E.appendChild(WEBVR.getMessageContainer(e))}),WEBVR.getVRDisplay(function(e){p.vr.setDevice(e),E.appendChild(WEBVR.getButton(e,p.domElement))}))},this.setScene=function(e){v=e},this.setSize=function(e,t){this.width=e,this.height=t,h&&(h.aspect=this.width/this.height,h.updateProjectionMatrix()),p&&p.setSize(e,t)},this.play=function(){t=performance.now(),document.addEventListener("keydown",n),document.addEventListener("keyup",o),document.addEventListener("mousedown",i),document.addEventListener("mouseup",r),document.addEventListener("mousemove",s),document.addEventListener("touchstart",a),document.addEventListener("touchend",d),document.addEventListener("touchmove",u),w(f.start,arguments),p.animate(e)},this.stop=function(){document.removeEventListener("keydown",n),document.removeEventListener("keyup",o),document.removeEventListener("mousedown",i),document.removeEventListener("mouseup",r),document.removeEventListener("mousemove",s),document.removeEventListener("touchstart",a),document.removeEventListener("touchend",d),document.removeEventListener("touchmove",u),w(f.stop,arguments),p.animate(null)},this.dispose=function(){for(;E.children.length;)E.removeChild(E.firstChild);p.dispose(),p=v=h=void 0}}};